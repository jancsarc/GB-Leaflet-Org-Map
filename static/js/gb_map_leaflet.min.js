function setFeed(a,e){var i=L.control({position:"topright"});i.onAdd=function(e){var i=L.DomUtil.create("div","gb-update-feed-div");return i.innerHTML='<div class="gb-map-overlay"><div class="gb-panel gb-panel-default"><div class="gb-panel-heading"><h4>GBA Updates</h4></div><div class="gb-panel-body"><ul><li>'+a[0].name+a[0].action+a[0].modified+"</li><li>"+a[1].name+a[1].action+a[1].modified+"</li><li>"+a[2].name+a[2].action+a[2].modified+"</li><li>"+a[3].name+a[3].action+a[3].modified+"</li><li>"+a[4].name+a[4].action+a[4].modified+"</li></ul></div></div></div>",i},i.addTo(e)}function populateMap(a,e,i){var n,o,l,t=[];if(a.length<=0||null==a)$("#gb-map").hide();else{for(o=0;o<a.length;o++)if("undefined"!==a[o].latitude&&null!==a[o].latitude&&"undefined"!==a[o].longitude&&null!==a[o].longitude){var r,s=a[o].display_GBA_alliance_membership_status;r="Participating Member"==s?"<span class='map-label map-label-success'>Participating Member</span>":"Sponsor Member"==s?"<span class='map-label map-label-info'>Sponsor Member</span>":"<span class='map-label map-label-default'>"+s+"</span>";var c,d=a[o].custodian_count,p=a[o].app_count,m=null;0==d&&p>0?(c="<span class='map-label map-label-warning'>3rd Party Developer</span>",m="Orange"):(c="<span class='map-label map-label-success'>Data Custodian</span>",m="Green"),l='<div class="map-img-with-title"><img src="'+a[o].organization_thumbnail+'"/><h4>'+a[o].name+"</h4></div><ul><li>"+a[o].contact_email+"</li>"+(void 0!==p&&p>0?"<li>Number of apps: "+p+"</li>":"")+(void 0!==d&&d>0?"<li>Number of custodians: "+d+"</li>":"")+'</ul><div class="map-label-divs">'+r+c+"</div>"+(void 0!==i&&1==i?'<hr class="map-hr"> <a type="button" href="'+a[o].marketplace_url+'" class="map-btn map-btn-primary btn-block">More info</a>':"");var u=L.responsivePopup().setContent(l);n="Orange"==m?L.marker([a[o].latitude,a[o].longitude],{icon:orangeIcon}).addTo(e).bindPopup(u):L.marker([a[o].latitude,a[o].longitude],{icon:greenIcon}).addTo(e).bindPopup(u),t.push(n)}var g=L.featureGroup(t);e.fitBounds(g.getBounds())}}function initGBMap(a,e,i){if(null==a)return console.log("Please provide a valid token from the Green Button Directory Service"),void $("#gb-map").hide();null==e&&(e=!0),null==i&&(i=!0);var n=L.map("gb-map",{scrollWheelZoom:!1});L.tileLayer("https://api.mapbox.com/styles/v1/jancsarc/cj4pp0vd1asq42st6acdijnpf/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiamFuY3NhcmMiLCJhIjoiY2o0cG56cHgxMDNiZzJxbjBva213NWpzZSJ9.ggdOCnx7LPbI1sxjNFmf-A",{maxZoom:18,noWrap:!0,id:"mapbox.streets",continuousWorld:!1,maxBoundsViscosity:1,bounds:[[-90,-180],[90,180]],accessToken:"pk.eyJ1IjoiamFuY3NhcmMiLCJhIjoiY2o0cG56cHgxMDNiZzJxbjBva213NWpzZSJ9.ggdOCnx7LPbI1sxjNFmf-A"}).addTo(n);var o=L.control({position:"bottomleft"});o.onAdd=function(a){var e=L.DomUtil.create("div","info legend");return e.innerHTML='<i style="background: #cb8429;"></i> 3rd Party Developers<br><i style="background: #22ac1f;"></i> Data custodians<br>',e},o.addTo(n),n.attributionControl.setPrefix(""),$.ajax({url:"https://cdn.rawgit.com/jancsarc/GB-Leaflet-Org-Map/be558406/static/data/org_static_list.json",method:"GET",dataType:"json",cache:!1,success:function(a){populateMap(a,n,e)},error:function(a,e,i){$("#gb-map").hide()}})}var greenIcon=new L.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),orangeIcon=new L.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});
